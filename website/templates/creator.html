<!DOCTYPE html>
<html>
<head>
    <link href="{{ url_for('static', filename='css/main.82cfd66e.css') }}" rel="stylesheet" />
    <title>StoryVerse AI Hub</title>
    
    <script>
    function submitForm() {
        const title = document.getElementById('title').value;
        const language = document.getElementById('language').value;
        const token = document.getElementById('token').value;
        const uid = document.getElementById('uid').value;
        const storyToken = document.getElementById('storyToken').value;

        fetch('/creator', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ title, language, token, uid, storyToken })
        })
        .then(response => response.json())
        .then(data => {
            console.log(data);
        })
        .catch(error => {
            console.error('Error:', error);
        });
    }
    </script>
</head>
<body>
    <header class="">
        <div class="navbar navbar-default visible-xs">
          <button type="button" class="navbar-toggle collapsed">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a href="/" class="navbar-brand">StoryVerse AI Hub</a>
        </div>
    
        <nav class="sidebar">
          <div class="navbar-collapse" id="navbar-collapse">
            <div class="site-header hidden-xs">
              <a class="site-brand" href="/" title="">
                <img class="img-responsive site-logo" alt=""
                  src="{{ url_for('static', filename='assets/images/logo.jpg') }}">
                  StoryVerse AI Hub
              </a>
              <p>Powered by AI, we aim to seamlessly integrate picture books and audio with multilingual audio support (15+ languages). Our objective is to facilitate efficient language acquisition for users worldwide.</p>
            </div>
            <ul class="nav">
              <li><a href="/" title="">Home</a></li>
              <li><a href="/creator" title="">Story Creator</a></li>
              <li id="loginLink"><a href="/contact" title="">Login/Sign up</a></li>
              <!-- 其他連結... -->
              <li id="logout-li" style="display: none;"><a href="#" id="logout-link">Log out</a></li>
            </ul>
    
    
            <nav class="nav-footer">
              <p class="nav-footer-social-buttons">
                <a class="fa-icon" href="https://github.com/yshyshyshyshysh/AI_PictureBooks_Web.git" title="">
                  <i class="fa fa-github"></i>
                </a>
                <a class="fa-icon" href="https://github.com/AdventrousAstronaut/web-app/tree/main" title="">
                  <i class="fa fa-github"></i>
                </a>
              </p>
              <p>© Untitled | Website created with <a href="http://www.mashup-template.com/"
                  title="Create website with free html template">Mashup Template</a>/<a href="https://www.unsplash.com/"
                  title="Beautiful Free Images">Unsplash</a></p>
            </nav>
          </div>
        </nav>
      </header>
      <main class="container">
        <div class="row">
            <div class="col-md-8 col-md-offset-2">
                <h1>Create a picture book</h1>
                <form onsubmit="submitForm(); return false;">
                    <div class="form-group">
                        <label for="title">Title:</label>
                        <input type="text" id="title" name="title" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="language">Language:</label>
                        <select id="language" name="language" class="form-control">
                            <option value="en">英語</option>
                            <option value="es">西班牙語</option>
                            <option value="fr">法語</option>
                            <option value="de">德語</option>
                            <option value="it">意大利語</option>
                            <option value="pt">葡萄牙語</option>
                            <option value="pl">波蘭語</option>
                            <option value="tr">土耳其語</option>
                            <option value="ru">俄語</option>
                            <option value="nl">荷蘭語</option>
                            <option value="cs">捷克語</option>
                            <option value="ar">阿拉伯語</option>
                            <option value="zh-cn">簡體中文</option>
                            <option value="hu">匈牙利語</option>
                            <option value="ko">韓語</option>
                            <option value="ja">日語</option>
                            <option value="hi">印地語</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="token">User Access Token:</label> 
                        <a href="https://huggingface.co/settings/tokens" target="_blank">Get from here</a><br>                      
                        <input type="text" id="token" name="token" class="form-control">
                    </div>
                    <button type="submit" class="btn btn-primary">Submit</button>
                </form>
            </div>
        </div>
    </main>
</body>
<div class="hero-full-wrapper">
    <div class="grid">
      <div class="gutter-sizer"></div>
      <div class="grid-sizer"></div>
  
    
      
      <!-- 更多的故事图片 -->
    </div> 
  </div>

<script src="https://www.gstatic.com/firebasejs/5.0.0/firebase-app.js"></script>

<script src="https://www.gstatic.com/firebasejs/5.0.0/firebase-auth.js"></script>

<script src="https://www.gstatic.com/firebasejs/5.0.0/firebase-database.js"></script>

<script src="{{ url_for('static', filename='hello-world/public/controller/config.js') }}"></script>

<script src="{{ url_for('static', filename='hello-world/public/controller/auth.js') }}"></script>
<script src="{{ url_for('static', filename='hello-world/public/controller/insert.js') }}"></script>
<script>
  function submitForm() {
      const title = document.getElementById('title').value;
      const language = document.getElementById('language').value;
      const token = document.getElementById('token').value;

      fetch('/creator', {
          method: 'POST',
          headers: {
              'Content-Type': 'application/json'
          },
          body: JSON.stringify({ title, language, token })
      })
      .then(response => response.json())
      .then(data => {
          console.log(data);
      })
      .catch(error => {
          console.error('Error:', error);
      });
  }
  async function getUserInfo() {
    const user = await retUserInfo();
    console.log(user);
    const displayNameElement = document.getElementById('displayName');
    const phoneNumberElement = document.getElementById('phoneNumber');


    emailInput.value = user.email;
    nameInput.value = user.displayName;

    // 設置displayName和phoneNumber的內容
    displayNameElement.textContent = user.displayName || 'No Display Name';
    phoneNumberElement.textContent = user.phoneNumber || 'No Phone Number'; 
}

function updateUserInfo(displayName, email, phoneNumber, bio, pronoun) {
  // const user = await retUserInfo();
  retUserInfo().then(user => {
      user.updateProfile({
          displayName: displayName,
          phoneNumber: phoneNumber
      }).then(function() {
          // Update successful.
          console.log("User profile updated successfully.");
          getUserInfo();
      }).catch(function(error) {
          // An error happened.
          console.error("Error updating user profile:", error);
      });
      
      // Update email, phone number, bio, pronoun
      const userRef = firebase.database().ref('users/' + user.uid);
      userRef.update({
          email: email,
          phoneNumber: phoneNumber,
          bio: bio,
          pronoun: pronoun
      }).then(function() {
          console.log("User info updated successfully.");
      }).catch(function(error) {
          console.error("Error updating user info:", error);
      });
  }).catch(error => {
      console.error(error);
  });
}


function handleSubmit() {
  const displayName = document.getElementById('nameInput').value;
  const email = document.getElementById('emailInput').value;
  const phoneNumber = document.getElementById('phoneInput').value;
  const bio = document.getElementById('bioInput').value;
  const pronoun = document.getElementById('pronounInput').value;

  // updateUserInfo(displayName, email, phoneNumber, bio, pronoun).then(() => {
  //   setTimeout(function() {
  //     alert("Profile updated!");
  //   }, 1000); // 延遲 1 秒顯示通知
  // });
  alert("Profile updated!");
  setTimeout(function() {
    updateUserInfo(displayName, email, phoneNumber, bio, pronoun);
    }, 500); // 延遲 1 秒顯示通知
}

// function handleSubmit() {
//   const displayName = document.querySelector('input[placeholder="this will be the display name "]').value;
//   const email = document.getElementById('emailInput').value;
//   const phoneNumber = document.querySelector('phoneInput').value;
//   const bio = document.querySelector('bioInput').value;
//   const pronoun = document.querySelector('pronounInput').value;

//   updateUserInfo(displayName, email, phoneNumber, bio, pronoun);
// }

document.addEventListener('DOMContentLoaded', function() {
    const saveProfileButton = document.getElementById('saveProfileButton');
    saveProfileButton.addEventListener('click', handleSubmit);
    // alert("Profile updated!");
});



  getUserInfo();



//                       how to show stories|
//                                          v
function myStoryImages(id) {
    getMyStories(id).then(data => {
        if (!data) {
            console.error('No data received from Firebase');
            return;
        }

        const stories = Object.values(data);
        console.log('Fetched stories:', stories); // 调试信息
        const gridContainer = document.querySelector('.grid');

        if (stories.length > 0) {
            const story = stories[0]; // 只取第一個故事
            const gridItem = document.createElement('div');
            gridItem.classList.add('grid-item');
            gridItem.setAttribute('data-id', story.signature);

            const img = document.createElement('img');
            img.classList.add('img-responsive', 'story-image');
            img.alt = story.title;

            const imageUrl = story.image;
            if (imageUrl) {
                img.src = imageUrl;
            } else {
                console.error(`No picture found for story:`, story); // 调试信息
                img.src = '{{ url_for('static', filename='assets/images/default.jpg') }}'; // 使用默认图片
            }

            const projectDescription = document.createElement('a');
            projectDescription.href = "/project"; // 使用 # 作为临时链接
            projectDescription.classList.add('project-description');

            projectDescription.addEventListener('click', function() {
                localStorage.setItem('selectedStory', JSON.stringify(story));
                window.location.href = '/project.html';
            });

            const projectTextHolder = document.createElement('div');
            projectTextHolder.classList.add('project-text-holder');

            const projectTextInner = document.createElement('div');
            projectTextInner.classList.add('project-text-inner');

            const h3 = document.createElement('h3');
            h3.textContent = story.title;

            const p = document.createElement('p');
            p.textContent = 'Discover more';

            projectTextInner.appendChild(h3);
            projectTextInner.appendChild(p);
            projectTextHolder.appendChild(projectTextInner);
            projectDescription.appendChild(projectTextHolder);

            gridItem.appendChild(img);
            gridItem.appendChild(projectDescription);
            gridContainer.appendChild(gridItem);
        } else {
            console.error('No stories available.');
        }

    }).catch(error => {
        console.error('Error fetching stories:', error); // 调试信息
    });
}

    myStoryImages("id4");


// if (user) {
        // document.getElementById('avatar').src = user.avatarURL;
        // document.getElementById('intro').innerText = user.intro;
        // console.log(user.avatarURL)
        // console.log(user.intro)
    //     console.log(user);
    // } else {
    //     console.log("User not found.");
    // }

// const username = localStorage.getItem("username");
// const user = retUserInfo()
//         document.getElementById('avatar').src = user.avatarURL;
//         document.getElementById('intro').innerText = user.intro;
//         console.log(user.avatarURL)
//         console.log(user.intro)

// retUserInfo();//test

  </script>
<script src="{{ url_for('static', filename='/hello-world/public/controller/auth.js') }}"></script>
<script src="{{ url_for('static', filename='js/login.js') }}"></script>
</html>